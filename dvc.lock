schema: '2.0'
stages:
  ingest:
    cmd: python pipelines/ingest_pipeline.py
    deps:
    - path: data/raw/ml-100k/u.data
      hash: md5
      md5: 6e47046882bad158b0efbb84cd5cb987
      size: 1979173
    - path: data/raw/ml-100k/u.item
      hash: md5
      md5: c9e7f390115d79079537301d5204f3f7
      size: 236344
    - path: data/raw/ml-100k/u.user
      hash: md5
      md5: 1b53539edc13caad0282c8500608a319
      size: 22628
    - path: pipelines/ingest_pipeline.py
      hash: md5
      md5: b56c18c06617bab7f541ccd74a2607e8
      size: 1788
    - path: src/ingest_strategy.py
      hash: md5
      md5: 5ad652acedbe06a9d016afa7201e7cc7
      size: 1820
    - path: steps/ingest_data.py
      hash: md5
      md5: 391065f6fda3dca71df44bd6217ff1a7
      size: 992
    params:
      params.yaml:
        ingest.base_path: data/raw/ml-100k
        ingest.processed_dir: data/processed
    outs:
    - path: data/processed
      hash: md5
      md5: c4cd683f670cf1c0d88cda46cd1a5eb9.dir
      size: 2239923
      nfiles: 3
  process_ratings:
    cmd: python pipelines/ratings_pipeline.py
    deps:
    - path: data/processed/ratings.csv
      hash: md5
      md5: ad3c6cf0bc7d2e9d40d33a64366258f0
      size: 1979206
    - path: pipelines/ratings_pipeline.py
      hash: md5
      md5: 72ced41a91ae298d30dc2e9d2fc6e00a
      size: 1174
    - path: steps/prepare_data.py
      hash: md5
      md5: 29d95600126eeeb362947efe9f812cef
      size: 2714
    params:
      params.yaml:
        process_ratings.file_path: data/processed/ratings.csv
        process_ratings.out_dir: feature_repo/data/ratings
        process_ratings.test_size: 0.2
        process_ratings.timestamp_col: timestamp
    outs:
    - path: feature_repo/data/ratings
      hash: md5
      md5: 36ccfa8526eff1bfcbed13fd34319061.dir
      size: 989181
      nfiles: 2
  process_movies:
    cmd: python pipelines/movies_pipeline.py
    deps:
    - path: data/processed/movies.csv
      hash: md5
      md5: b90af40d0a885d001df74b8b2d764436
      size: 238050
    - path: pipelines/movies_pipeline.py
      hash: md5
      md5: 50fee694d77991cfa4c96a1ea42263c6
      size: 1203
    - path: steps/prepare_data.py
      hash: md5
      md5: 29d95600126eeeb362947efe9f812cef
      size: 2714
    params:
      params.yaml:
        process_movies.date_col: release_date
        process_movies.file_path: data/processed/movies.csv
        process_movies.max_features: 1000
        process_movies.out_dir: feature_repo/data/movies
        process_movies.vectorize_col: title
    outs:
    - path: feature_repo/data/movies
      hash: md5
      md5: 9bae3ac5a24a214229dbd5be07f8222b.dir
      size: 102055
      nfiles: 1
  process_users:
    cmd: python pipelines/users_pipeline.py
    deps:
    - path: data/processed/users.csv
      hash: md5
      md5: 7a2b704cd2dca88a29d97790a923ff81
      size: 22667
    - path: pipelines/users_pipeline.py
      hash: md5
      md5: 26ccfcd84675c5b56f656b77e44f6c0f
      size: 908
    - path: steps/prepare_data.py
      hash: md5
      md5: 29d95600126eeeb362947efe9f812cef
      size: 2714
    params:
      params.yaml:
        process_users.enc_cols:
        - gender
        - occupation
        process_users.file_path: data/processed/users.csv
        process_users.out_dir: feature_repo/data/users
    outs:
    - path: feature_repo/data/users
      hash: md5
      md5: faeb10708a7c2db45ea021f79893ff4e.dir
      size: 34546
      nfiles: 1
  user_item_matrix:
    cmd: python -c "from pipelines.training_pipeline import 
      save_user_item_matrix; save_user_item_matrix()"
    deps:
    - path: pipelines/training_pipeline.py
      hash: md5
      md5: 04ff081f6363f5cfc72056423881478e
      size: 1574
    - path: src/model_dev.py
      hash: md5
      md5: 0b2242dcbb9c3da0714763d300a72ace
      size: 6508
    - path: steps/fetch_features.py
      hash: md5
      md5: 1c407403a2d45bbedef6491bf1f759f0
      size: 3955
    outs:
    - path: model/user_item_matrix.pkl
      hash: md5
      md5: d2f2583c12b50b43a0dd9f7632a795ea
      size: 12423645
  top_n_rating:
    cmd: python -c "from pipelines.training_pipeline import 
      top_n_rating_pipeline; top_n_rating_pipeline()"
    deps:
    - path: pipelines/training_pipeline.py
      hash: md5
      md5: c1b0cb4b9688cee530ba0f91992b2125
      size: 1333
    - path: src/model_dev.py
      hash: md5
      md5: f7b1c6f839d060590cb47529238ddc40
      size: 6431
    - path: steps/fetch_features.py
      hash: md5
      md5: 00eedcabe1c2c31a1f31e895e08f097d
      size: 3925
    - path: steps/train_model.py
      hash: md5
      md5: 2188e71dc1fa695b7d8ef9c74876c9bc
      size: 1901
    outs:
    - path: model/popularity_model.pkl
      hash: md5
      md5: 2b69518f5442f5d91097c12aaa4570de
      size: 40086
  user_based_cf:
    cmd: python -c "from pipelines.training_pipeline import 
      user_based_cf_pipeline; user_based_cf_pipeline()"
    deps:
    - path: model/user_item_matrix.pkl
      hash: md5
      md5: d2f2583c12b50b43a0dd9f7632a795ea
      size: 12423645
    - path: pipelines/training_pipeline.py
      hash: md5
      md5: 04ff081f6363f5cfc72056423881478e
      size: 1574
    - path: src/model_dev.py
      hash: md5
      md5: 0b2242dcbb9c3da0714763d300a72ace
      size: 6508
    - path: steps/fetch_features.py
      hash: md5
      md5: 1c407403a2d45bbedef6491bf1f759f0
      size: 3955
    - path: steps/train_model.py
      hash: md5
      md5: 8ddff7adfee829012e80c389c632e066
      size: 1612
    outs:
    - path: model/user_based_cf_model.pkl
      hash: md5
      md5: 8e25a2fec3a7b8684bb57ca00a08a49b
      size: 7122099
  item_based_cf:
    cmd: python -c "from pipelines.training_pipeline import 
      item_based_cf_pipeline; item_based_cf_pipeline()"
    deps:
    - path: model/user_item_matrix.pkl
      hash: md5
      md5: d2f2583c12b50b43a0dd9f7632a795ea
      size: 12423645
    - path: pipelines/training_pipeline.py
      hash: md5
      md5: 04ff081f6363f5cfc72056423881478e
      size: 1574
    - path: src/model_dev.py
      hash: md5
      md5: 0b2242dcbb9c3da0714763d300a72ace
      size: 6508
    - path: steps/fetch_features.py
      hash: md5
      md5: 1c407403a2d45bbedef6491bf1f759f0
      size: 3955
    - path: steps/train_model.py
      hash: md5
      md5: 8ddff7adfee829012e80c389c632e066
      size: 1612
    outs:
    - path: model/item_based_cf_model.pkl
      hash: md5
      md5: 9bbddecb3299a0b651bb61fdfb8c16cb
      size: 21635603
  fetch_tmdb_metadata:
    cmd: python pipelines/tmdb_metadata_pipeline.py
    deps:
    - path: pipelines/tmdb_metadata_pipeline.py
      hash: md5
      md5: e843ab8e6300ed79a32c00adf68f3e27
      size: 4790
    - path: services/tv_api.py
      hash: md5
      md5: 77447d58a0abbfa3293de199252ef6dc
      size: 3212
    - path: src/base_client.py
      hash: md5
      md5: 3253cefdff8be36fe8258c86b523e10b
      size: 1542
    - path: src/base_client.py
      hash: md5
      md5: 3253cefdff8be36fe8258c86b523e10b
      size: 1542
    - path: utils/downloader.py
      hash: md5
      md5: 773083168180c0a9b00505e317d5ac7c
      size: 2412
    outs:
    - path: data/raw/movie_ids.json
      hash: md5
      md5: ca38115130a01b03af0c9efceb61176d
      size: 103563
    - path: data/raw/movies_metadata.json
      hash: md5
      md5: e160169b3462266ebdecbbc9d1777e46
      size: 836545603
    - path: data/raw/tv_ids.json
      hash: md5
      md5: 2d9772f2c041a25e66666317380c159b
      size: 73753
    - path: data/raw/tv_metadata.json
      hash: md5
      md5: 04fdee3233224998d3c1ab202316cbf3
      size: 940973071
  extract_tmdb_features:
    cmd: python src/extract_tmdb_features.py
    deps:
    - path: data/raw/movies_metadata.json
      hash: md5
      md5: e160169b3462266ebdecbbc9d1777e46
      size: 836545603
    - path: data/raw/tv_metadata.json
      hash: md5
      md5: 04fdee3233224998d3c1ab202316cbf3
      size: 940973071
    - path: src/extract_tmdb_features.py
      hash: md5
      md5: 4e00bf099cd5e504f5dd2c9d26dcee72
      size: 3872
    outs:
    - path: data/raw/movies_features.json
      hash: md5
      md5: 01fa547f9fde68962fa3cf8ed46f0a90
      size: 111796175
    - path: data/raw/tv_features.json
      hash: md5
      md5: 34dc0b46a4dc9ff38785bdcdae3b8b25
      size: 107513727
  process_ratings_movielens:
    cmd: python pipelines/ratings_pipeline_movielens.py
    deps:
    - path: data/processed/ratings.csv
      hash: md5
      md5: ad3c6cf0bc7d2e9d40d33a64366258f0
      size: 1979206
    - path: pipelines/ratings_pipeline_movielens.py
      hash: md5
      md5: 54f7e240832a8406312f89d3ecfe04d1
      size: 1184
    - path: src/data_strategy.py
      hash: md5
      md5: 03dd82587d7270eeb22b2529eebfa913
      size: 10499
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_ratings_movielens.file_path: data/processed/ratings.csv
        process_ratings_movielens.out_dir: feature_repo/data/ratings_movielens
        process_ratings_movielens.test_size: 0.2
        process_ratings_movielens.timestamp_col: timestamp
    outs:
    - path: feature_repo/data/ratings_movielens
      hash: md5
      md5: 36ccfa8526eff1bfcbed13fd34319061.dir
      size: 989181
      nfiles: 2
  process_movies_movielens:
    cmd: python pipelines/movies_pipeline_movielens.py
    deps:
    - path: data/processed/movies.csv
      hash: md5
      md5: b90af40d0a885d001df74b8b2d764436
      size: 238050
    - path: pipelines/movies_pipeline_movielens.py
      hash: md5
      md5: 657d0d2d4250390da4f5da737676ddb7
      size: 1327
    - path: src/data_strategy.py
      hash: md5
      md5: 03dd82587d7270eeb22b2529eebfa913
      size: 10499
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_movies_movielens.date_col: release_date
        process_movies_movielens.file_path: data/processed/movies.csv
        process_movies_movielens.max_features: 1000
        process_movies_movielens.out_dir: feature_repo/data/movies_movielens
        process_movies_movielens.vectorize_col: title
    outs:
    - path: feature_repo/data/movies_movielens
      hash: md5
      md5: 9bae3ac5a24a214229dbd5be07f8222b.dir
      size: 102055
      nfiles: 1
  process_users_movielens:
    cmd: python pipelines/users_pipeline_movielens.py
    deps:
    - path: data/processed/users.csv
      hash: md5
      md5: 7a2b704cd2dca88a29d97790a923ff81
      size: 22667
    - path: pipelines/users_pipeline_movielens.py
      hash: md5
      md5: 993034be92c2d51c847526fd8bbdfa27
      size: 918
    - path: src/data_strategy.py
      hash: md5
      md5: 03dd82587d7270eeb22b2529eebfa913
      size: 10499
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_users_movielens.enc_cols:
        - gender
        - occupation
        process_users_movielens.file_path: data/processed/users.csv
        process_users_movielens.out_dir: feature_repo/data/users_movielens
    outs:
    - path: feature_repo/data/users_movielens
      hash: md5
      md5: 954f8064df37c5b29dc5a3bb1a1da4cb.dir
      size: 34546
      nfiles: 1
  process_movies_tmdb:
    cmd: python pipelines/movies_pipeline_tmdb.py
    deps:
    - path: pipelines/movies_pipeline_tmdb.py
      hash: md5
      md5: b503d095763eb4e2dd5177946b5a736a
      size: 3113
    - path: src/data_strategy.py
      hash: md5
      md5: 03dd82587d7270eeb22b2529eebfa913
      size: 10499
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_movies_tmdb.drop_cols:
        - poster_path
        - backdrop_path
        - videos
        process_movies_tmdb.enc_cols:
        - original_language
        - origin_country
        - production_countries
        process_movies_tmdb.file_path: data/raw/movies_features.json
        process_movies_tmdb.log_transform_cols:
        - vote_count
        - budget
        - revenue
        - popularity
        process_movies_tmdb.multi_lable_enc_cols:
        - genres
        process_movies_tmdb.normalize_col:
        - vote_average
        process_movies_tmdb.out_dir: feature_repo/data/movies_tmdb
        process_movies_tmdb.output_cols:
        - title_vectorize
        - overview_vectorize
        - keywords_vectorize
        - cast_vectorize
        - crew_vectorize
        process_movies_tmdb.vectorize_cols:
        - title
        - overview
        - keywords
        - cast
        - crew
    outs:
    - path: feature_repo/data/movies_tmdb
      hash: md5
      md5: 5c87965d0d36f1e0c5cebc654867c942.dir
      size: 197133894
      nfiles: 2
