schema: '2.0'
stages:
  ingest:
    cmd: python pipelines/ingest_pipeline.py
    deps:
    - path: data/raw/ml-100k/u.data
      hash: md5
      md5: 6e47046882bad158b0efbb84cd5cb987
      size: 1979173
    - path: data/raw/ml-100k/u.item
      hash: md5
      md5: c9e7f390115d79079537301d5204f3f7
      size: 236344
    - path: data/raw/ml-100k/u.user
      hash: md5
      md5: 1b53539edc13caad0282c8500608a319
      size: 22628
    - path: pipelines/ingest_pipeline.py
      hash: md5
      md5: b56c18c06617bab7f541ccd74a2607e8
      size: 1788
    - path: src/ingest_strategy.py
      hash: md5
      md5: 5ad652acedbe06a9d016afa7201e7cc7
      size: 1820
    - path: steps/ingest_data.py
      hash: md5
      md5: 391065f6fda3dca71df44bd6217ff1a7
      size: 992
    params:
      params.yaml:
        ingest.base_path: data/raw/ml-100k
        ingest.processed_dir: data/processed
    outs:
    - path: data/processed
      hash: md5
      md5: c4cd683f670cf1c0d88cda46cd1a5eb9.dir
      size: 2239923
      nfiles: 3
  process_ratings:
    cmd: python pipelines/ratings_pipeline.py
    deps:
    - path: data/processed/ratings.csv
      hash: md5
      md5: ad3c6cf0bc7d2e9d40d33a64366258f0
      size: 1979206
    - path: pipelines/ratings_pipeline.py
      hash: md5
      md5: 72ced41a91ae298d30dc2e9d2fc6e00a
      size: 1174
    - path: steps/prepare_data.py
      hash: md5
      md5: 29d95600126eeeb362947efe9f812cef
      size: 2714
    params:
      params.yaml:
        process_ratings.file_path: data/processed/ratings.csv
        process_ratings.out_dir: feature_repo/data/ratings
        process_ratings.test_size: 0.2
        process_ratings.timestamp_col: timestamp
    outs:
    - path: feature_repo/data/ratings
      hash: md5
      md5: 36ccfa8526eff1bfcbed13fd34319061.dir
      size: 989181
      nfiles: 2
  process_movies:
    cmd: python pipelines/movies_pipeline.py
    deps:
    - path: data/processed/movies.csv
      hash: md5
      md5: b90af40d0a885d001df74b8b2d764436
      size: 238050
    - path: pipelines/movies_pipeline.py
      hash: md5
      md5: 50fee694d77991cfa4c96a1ea42263c6
      size: 1203
    - path: steps/prepare_data.py
      hash: md5
      md5: 29d95600126eeeb362947efe9f812cef
      size: 2714
    params:
      params.yaml:
        process_movies.date_col: release_date
        process_movies.file_path: data/processed/movies.csv
        process_movies.max_features: 1000
        process_movies.out_dir: feature_repo/data/movies
        process_movies.vectorize_col: title
    outs:
    - path: feature_repo/data/movies
      hash: md5
      md5: 9bae3ac5a24a214229dbd5be07f8222b.dir
      size: 102055
      nfiles: 1
  process_users:
    cmd: python pipelines/users_pipeline.py
    deps:
    - path: data/processed/users.csv
      hash: md5
      md5: 7a2b704cd2dca88a29d97790a923ff81
      size: 22667
    - path: pipelines/users_pipeline.py
      hash: md5
      md5: 26ccfcd84675c5b56f656b77e44f6c0f
      size: 908
    - path: steps/prepare_data.py
      hash: md5
      md5: 29d95600126eeeb362947efe9f812cef
      size: 2714
    params:
      params.yaml:
        process_users.enc_cols:
        - gender
        - occupation
        process_users.file_path: data/processed/users.csv
        process_users.out_dir: feature_repo/data/users
    outs:
    - path: feature_repo/data/users
      hash: md5
      md5: faeb10708a7c2db45ea021f79893ff4e.dir
      size: 34546
      nfiles: 1
  user_item_matrix:
    cmd: python -c "from pipelines.training_pipeline import 
      save_user_item_matrix; save_user_item_matrix()"
    deps:
    - path: pipelines/training_pipeline.py
      hash: md5
      md5: 5bfa53af7408442a0690a5b0b0290bb2
      size: 1935
    - path: src/model_dev.py
      hash: md5
      md5: e1ed35efffcbd1a1dd3babc0b841d6e2
      size: 7747
    - path: steps/get_historical_features.py
      hash: md5
      md5: 9b12d185342a9fa17fc4ddcf545aaf72
      size: 5810
    outs:
    - path: model/user_item_matrix.pkl
      hash: md5
      md5: 316ac1cf2efbc3307f225265c3fad70d
      size: 12423646
  top_n_rating:
    cmd: python -c "from pipelines.training_pipeline import 
      top_n_rating_pipeline; top_n_rating_pipeline()"
    deps:
    - path: pipelines/training_pipeline.py
      hash: md5
      md5: c1b0cb4b9688cee530ba0f91992b2125
      size: 1333
    - path: src/model_dev.py
      hash: md5
      md5: f7b1c6f839d060590cb47529238ddc40
      size: 6431
    - path: steps/fetch_features.py
      hash: md5
      md5: 00eedcabe1c2c31a1f31e895e08f097d
      size: 3925
    - path: steps/train_model.py
      hash: md5
      md5: 2188e71dc1fa695b7d8ef9c74876c9bc
      size: 1901
    outs:
    - path: model/popularity_model.pkl
      hash: md5
      md5: 2b69518f5442f5d91097c12aaa4570de
      size: 40086
  user_based_cf:
    cmd: python -c "from pipelines.training_pipeline import 
      user_based_cf_pipeline; user_based_cf_pipeline()"
    deps:
    - path: model/user_item_matrix.pkl
      hash: md5
      md5: 316ac1cf2efbc3307f225265c3fad70d
      size: 12423646
    - path: pipelines/training_pipeline.py
      hash: md5
      md5: 5bfa53af7408442a0690a5b0b0290bb2
      size: 1935
    - path: src/model_dev.py
      hash: md5
      md5: e1ed35efffcbd1a1dd3babc0b841d6e2
      size: 7747
    - path: steps/get_historical_features.py
      hash: md5
      md5: 9b12d185342a9fa17fc4ddcf545aaf72
      size: 5810
    - path: steps/train_model.py
      hash: md5
      md5: 8ddff7adfee829012e80c389c632e066
      size: 1612
  item_based_cf:
    cmd: python -c "from pipelines.training_pipeline import 
      item_based_cf_pipeline; item_based_cf_pipeline()"
    deps:
    - path: model/user_item_matrix.pkl
      hash: md5
      md5: 316ac1cf2efbc3307f225265c3fad70d
      size: 12423646
    - path: pipelines/training_pipeline.py
      hash: md5
      md5: 5bfa53af7408442a0690a5b0b0290bb2
      size: 1935
    - path: src/model_dev.py
      hash: md5
      md5: e1ed35efffcbd1a1dd3babc0b841d6e2
      size: 7747
    - path: steps/get_historical_features.py
      hash: md5
      md5: 9b12d185342a9fa17fc4ddcf545aaf72
      size: 5810
    - path: steps/train_model.py
      hash: md5
      md5: 8ddff7adfee829012e80c389c632e066
      size: 1612
  fetch_tmdb_metadata:
    cmd: python pipelines/tmdb_metadata_pipeline.py
    deps:
    - path: pipelines/tmdb_metadata_pipeline.py
      hash: md5
      md5: 98f895f658a1b2bf3e30d2ad05a67d68
      size: 5867
    - path: services/tv_api.py
      hash: md5
      md5: 77447d58a0abbfa3293de199252ef6dc
      size: 3212
    - path: src/base_client.py
      hash: md5
      md5: 3253cefdff8be36fe8258c86b523e10b
      size: 1542
    - path: src/base_client.py
      hash: md5
      md5: 3253cefdff8be36fe8258c86b523e10b
      size: 1542
    - path: utils/downloader.py
      hash: md5
      md5: fcec66a03bda09586a467b3579a47d12
      size: 4359
    outs:
    - path: app/static/images/cast
      hash: md5
      md5: 38beecb99eb85bf1f19c46d1c73932b8.dir
      size: 348382156
      nfiles: 15692
    - path: app/static/images/movie
      hash: md5
      md5: dcf531275650cecc11cdacaefbe960b9.dir
      size: 265891892
      nfiles: 9197
    - path: app/static/images/tv
      hash: md5
      md5: e6067015b89c2821e61edb7b69fb963a.dir
      size: 175283141
      nfiles: 5644
    - path: data/raw/movies_metadata.json
      hash: md5
      md5: 1c477d0578302670163df9b3ae9ce260
      size: 624968896
    - path: data/raw/tv_metadata.json
      hash: md5
      md5: 785ebbf18be56b5a7cd977153eecb865
      size: 757877720
  extract_tmdb_features:
    cmd: python steps/extract_tmdb_features.py
    deps:
    - path: data/raw/movies_metadata.json
      hash: md5
      md5: 1c477d0578302670163df9b3ae9ce260
      size: 624968896
    - path: data/raw/tv_metadata.json
      hash: md5
      md5: 785ebbf18be56b5a7cd977153eecb865
      size: 757877720
    - path: steps/extract_tmdb_features.py
      hash: md5
      md5: 0a5ff303baa1d80e4116ad11ec2a34b4
      size: 5695
    outs:
    - path: data/raw/movie_cast_metadata.json
      hash: md5
      md5: d4ef898793c7092782b01d04488c34f6
      size: 3332163
    - path: data/raw/movies_features.json
      hash: md5
      md5: 5061d23349e8d9a02ec049f7710b7556
      size: 10516078
    - path: data/raw/movies_reviews.json
      hash: md5
      md5: 2d4e2eafefc3481ec144e8dace06e7c9
      size: 23532689
    - path: data/raw/tv_cast_metadata.json
      hash: md5
      md5: 5e98a55105cfa47954b40a9f259e8ded
      size: 1876889
    - path: data/raw/tv_features.json
      hash: md5
      md5: ed81099c502c1c5b860c96e37af4b39c
      size: 5950341
    - path: data/raw/tv_reviews.json
      hash: md5
      md5: 3c83bbe6b835ea2afc17f16fe10b63e4
      size: 2307813
  process_ratings_movielens:
    cmd: python pipelines/ratings_pipeline_movielens.py
    deps:
    - path: data/processed/ratings.csv
      hash: md5
      md5: ad3c6cf0bc7d2e9d40d33a64366258f0
      size: 1979206
    - path: pipelines/ratings_pipeline_movielens.py
      hash: md5
      md5: 54f7e240832a8406312f89d3ecfe04d1
      size: 1184
    - path: src/data_strategy.py
      hash: md5
      md5: 88e145d328c94dad8b4b55dd38f37126
      size: 10645
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_ratings_movielens.file_path: data/processed/ratings.csv
        process_ratings_movielens.out_dir: feature_repo/data/ratings_movielens
        process_ratings_movielens.test_size: 0.2
        process_ratings_movielens.timestamp_col: timestamp
    outs:
    - path: feature_repo/data/ratings_movielens
      hash: md5
      md5: e200bab1a814ae28d8d3fbd8ff00c612.dir
      size: 989181
      nfiles: 2
  process_movies_movielens:
    cmd: python pipelines/movies_pipeline_movielens.py
    deps:
    - path: data/processed/movies.csv
      hash: md5
      md5: b90af40d0a885d001df74b8b2d764436
      size: 238050
    - path: pipelines/movies_pipeline_movielens.py
      hash: md5
      md5: ec64014316d6815de46f5f75d22ccba8
      size: 1458
    - path: src/data_strategy.py
      hash: md5
      md5: 88e145d328c94dad8b4b55dd38f37126
      size: 10645
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_movies_movielens.date_col: release_date
        process_movies_movielens.file_path: data/processed/movies.csv
        process_movies_movielens.max_features: 1000
        process_movies_movielens.out_dir: feature_repo/data/movies_movielens
        process_movies_movielens.vectorize_col: title
    outs:
    - path: feature_repo/data/movies_movielens
      hash: md5
      md5: bcc85a7fe94f72c7822c75b7b7a27087.dir
      size: 101685
      nfiles: 1
  process_users_movielens:
    cmd: python pipelines/users_pipeline_movielens.py
    deps:
    - path: data/processed/users.csv
      hash: md5
      md5: 7a2b704cd2dca88a29d97790a923ff81
      size: 22667
    - path: pipelines/users_pipeline_movielens.py
      hash: md5
      md5: 993034be92c2d51c847526fd8bbdfa27
      size: 918
    - path: src/data_strategy.py
      hash: md5
      md5: 88e145d328c94dad8b4b55dd38f37126
      size: 10645
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_users_movielens.enc_cols:
        - gender
        - occupation
        process_users_movielens.file_path: data/processed/users.csv
        process_users_movielens.out_dir: feature_repo/data/users_movielens
    outs:
    - path: feature_repo/data/users_movielens
      hash: md5
      md5: 428334f153591e9af43aedb2720ead5e.dir
      size: 34546
      nfiles: 1
  process_movies_tmdb:
    cmd: python pipelines/movies_pipeline_tmdb.py
    deps:
    - path: pipelines/movies_pipeline_tmdb.py
      hash: md5
      md5: 2a568f12b4399833ee578e754c9b424f
      size: 3458
    - path: src/data_strategy.py
      hash: md5
      md5: 88e145d328c94dad8b4b55dd38f37126
      size: 10645
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_movies_tmdb.drop_cols:
        - poster_path
        - backdrop_path
        - video
        process_movies_tmdb.enc_cols:
        - original_language
        - origin_country
        - production_countries
        process_movies_tmdb.features_out_dir: 
          feature_repo/data/movies_tmdb/features
        process_movies_tmdb.file_path: data/raw/movies_features.json
        process_movies_tmdb.log_transform_cols:
        - vote_count
        - budget
        - revenue
        - popularity
        process_movies_tmdb.multi_lable_enc_cols:
        - genres
        process_movies_tmdb.normalize_col:
        - vote_average
        - runtime
        process_movies_tmdb.output_cols:
        - title_vectorize
        - overview_vectorize
        - keywords_vectorize
        - cast_vectorize
        - crew_vectorize
        process_movies_tmdb.reviews_out_dir: 
          feature_repo/data/movies_tmdb/reviews
        process_movies_tmdb.vectorize_cols:
        - title
        - overview
        - keywords
        - cast
        process_tv_tmdb.keep_cols:
        - id
        - title
        - overview
        - vote_average
        - vote_count
        - genres
        - video_key
    outs:
    - path: feature_repo/data/movies_tmdb
      hash: md5
      md5: bb238e4c86bf425ee069fa411864d282.dir
      size: 129872627
      nfiles: 2
  process_tv_tmdb:
    cmd: python pipelines/tv_pipeline_tmdb.py
    deps:
    - path: pipelines/tv_pipeline_tmdb.py
      hash: md5
      md5: 99a82098cadcc325023a2df3266cf6ff
      size: 3430
    - path: src/data_strategy.py
      hash: md5
      md5: 88e145d328c94dad8b4b55dd38f37126
      size: 10645
    - path: steps/prepare_data.py
      hash: md5
      md5: 711150d08e113b619261c9c622bebb23
      size: 3491
    params:
      params.yaml:
        process_tv_tmdb.drop_cols:
        - poster_path
        - backdrop_path
        - video
        process_tv_tmdb.enc_cols:
        - original_language
        - origin_country
        - production_countries
        process_tv_tmdb.features_out_dir: feature_repo/data/tv_tmdb/features
        process_tv_tmdb.file_path: data/raw/tv_features.json
        process_tv_tmdb.keep_cols:
        - id
        - title
        - overview
        - vote_average
        - vote_count
        - genres
        - video_key
        process_tv_tmdb.log_transform_cols:
        - vote_count
        - budget
        - revenue
        - popularity
        process_tv_tmdb.multi_lable_enc_cols:
        - genres
        process_tv_tmdb.normalize_col:
        - vote_average
        - runtime
        process_tv_tmdb.output_cols:
        - title_vectorize
        - overview_vectorize
        - keywords_vectorize
        - cast_vectorize
        - crew_vectorize
        process_tv_tmdb.reviews_out_dir: feature_repo/data/tv_tmdb/reviews
        process_tv_tmdb.vectorize_cols:
        - title
        - overview
        - keywords
        - cast
    outs:
    - path: feature_repo/data/tv_tmdb
      hash: md5
      md5: 7db15ce71556fc611565a2106973b5df.dir
      size: 58939283
      nfiles: 2
